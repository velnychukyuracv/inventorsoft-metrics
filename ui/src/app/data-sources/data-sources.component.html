<div class="container-fluid">
    <div class="row py-2">
        <div class="col">
            <button type="button" class="btn btn-outline-primary float-right" data-toggle="modal" data-target="#dataSourceModal"
                    (click)="openAddModal()">
                Create
            </button>
        </div>
    </div>
    <table class="table table-hover table-sm"
           sortable-table (sorted)="onSorted($event)"
    >
        <thead>
        <tr>
            <th sortable-column="id">#</th>
            <th sortable-column="url">URL</th>
            <th sortable-column="dataSourceName">Data Source Name</th>
            <th sortable-column="driverClassName">Driver</th>
            <th sortable-column="dataSourceType">Source Type</th>
            <th sortable-column="createdAt">Created</th>
            <th sortable-column="updatedAt">Updated</th>
            <th colspan="2">Actions</th>
        </tr>
        </thead>
        <tbody *ngIf="dataSources?.length > 0">
        <tr *ngFor="let source of dataSources">
            <td>{{source.id}}</td>
            <td>{{source.url}}</td>
            <td>{{source.dataSourceName}}</td>
            <td>{{source.driverClassName}}</td>
            <td>{{source.dataSourceType}}</td>
            <td>{{source.createdAt | date:'yyyy-MM-dd HH:mm:ss'}}</td>
            <td>{{source.updatedAt | date:'yyyy-MM-dd HH:mm:ss'}}</td>
            <td>
                <button type="button" class="btn btn-outline-success btn-sm" data-toggle="modal" data-target="#dataSourceModal"
                        (click)="openEditModal(source.id)">
                    Edit
                </button>
            </td>
            <td>
                <button type="button" class="btn btn-outline-danger btn-sm" data-toggle="modal" data-target="#confirmDeleteModal"
                        (click)="openDeleteModal(source.id)">
                    Delete
                </button>
            </td>
        </tr>

        </tbody>
    </table>

</div>

<div class="modal show" id="dataSourceModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Data Source Card</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="form-validate" [formGroup]="dataSourceForm">
                    <div class="form-group">
                        <label class="label-material">Data Source Name:</label>
                        <input required
                               class="form-control"
                               formControlName="dataSourceName"
                               [ngClass]="{'border border-danger': dataSourceForm.get('dataSourceName').invalid && dataSourceForm.get('dataSourceName').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('dataSourceName').invalid && dataSourceForm.get('dataSourceName').touched">
                            <span *ngIf="dataSourceForm.get('dataSourceName')['errors']['required']">Field 'dataSourceName' must be filled in.</span>
                            <span *ngIf="dataSourceForm.get('dataSourceName').hasError('minlength')">
                                dataSourceName should be at least {{ dataSourceForm.get('dataSourceName')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('dataSourceName')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="label-material">Data Source Type:</label>
                        <input required
                               class="form-control"
                               formControlName="dataSourceType"
                               [ngClass]="{'border border-danger': dataSourceForm.get('dataSourceType').invalid && dataSourceForm.get('dataSourceType').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('dataSourceType').invalid && dataSourceForm.get('dataSourceType').touched">
                            <span *ngIf="dataSourceForm.get('dataSourceType')['errors']['required']">Field 'dataSourceType' must be filled in.</span>
                            <span
                                *ngIf="dataSourceForm.get('dataSourceType').hasError('minlength')">
                                dataSourceType should be at least {{ dataSourceForm.get('dataSourceType')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('dataSourceType')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="label-material">Driver Class Name:</label>
                        <input required
                               class="form-control"
                               formControlName="driverClassName"
                               [ngClass]="{'border border-danger': dataSourceForm.get('driverClassName').invalid && dataSourceForm.get('driverClassName').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('driverClassName').invalid && dataSourceForm.get('driverClassName').touched">
                            <span *ngIf="dataSourceForm.get('driverClassName')['errors']['required']">Field 'driverClassName' must be filled in.</span>
                            <span *ngIf="dataSourceForm.get('driverClassName').hasError('minlength')">
                                driverClassName should be at least {{ dataSourceForm.get('driverClassName')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('driverClassName')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="label-material">url:</label>
                        <input required
                               class="form-control"
                               formControlName="url"
                               [ngClass]="{'border border-danger': dataSourceForm.get('url').invalid && dataSourceForm.get('url').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('url').invalid && dataSourceForm.get('url').touched">
                            <span *ngIf="dataSourceForm.get('url')['errors']['required']">Field 'url' must be filled in.</span>
                            <span *ngIf="dataSourceForm.get('url').hasError('minlength')">
                                url should be at least {{ dataSourceForm.get('url')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('url')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>

                    <div class="form-group" *ngIf="selectedDataSourceId === undefined">
                        <label class="label-material">Password:</label>
                        <input type="password"
                               required
                               class="form-control"
                               formControlName="password"
                               [ngClass]="{'border border-danger': dataSourceForm.get('password').invalid && dataSourceForm.get('password').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('password').invalid && dataSourceForm.get('password').touched">
                            <span *ngIf="dataSourceForm.get('password')['errors']['required']">Field 'password' must be filled in.</span>
                            <span *ngIf="dataSourceForm.get('password').hasError('minlength')">
                                password should be at least {{ dataSourceForm.get('password')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('password')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>

                    <div class="form-group" *ngIf="selectedDataSourceId === undefined">
                        <label class="label-material">User Name:</label>
                        <input required
                               class="form-control"
                               formControlName="userName"
                               [ngClass]="{'border border-danger': dataSourceForm.get('userName').invalid && dataSourceForm.get('userName').touched}"
                        />
                        <div class="alert alert-info mt-3"
                             *ngIf="dataSourceForm.get('userName').invalid && dataSourceForm.get('userName').touched">
                            <span *ngIf="dataSourceForm.get('userName')['errors']['required']">Field 'userName' must be filled in.</span>
                            <span *ngIf="dataSourceForm.get('userName').hasError('minlength')">
                                userName should be at least {{ dataSourceForm.get('userName')['errors']['minlength']['requiredLength'] }} characters long.
                                Now {{ dataSourceForm.get('userName')['errors']['minlength']['actualLength'] }} characters.
                            </span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" #btnCloseDataSource class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button *ngIf="selectedDataSourceId; else createBlock"
                        type="button"
                        [disabled]="dataSourceForm.invalid"
                        class="btn btn-primary"
                        (click)="editDataSource()">
                    Edit data source
                </button>
                <ng-template #createBlock>
                    <button type="button"
                            class="btn btn-primary"
                            [disabled]="dataSourceForm.invalid"
                            (click)="createDataSource()">
                        Add data source
                    </button>
                </ng-template>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Deleting</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure to delete data source?
            </div>
            <div class="modal-footer">
                <button type="button" #btnCloseConfirmDelete class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" (click)="deleteDataSource()">Delete</button>
            </div>
        </div>
    </div>
</div>